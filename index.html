<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <main>
    <picture></picture>
    <label class="theme-toggle" for="theme-switch" aria-label="Toggle dark / light mode">
      <input type="checkbox" id="theme-switch" disabled>
      <span class="theme-toggle__icon theme-toggle__icon--sun">â˜€</span>
      <span class="theme-toggle__track"></span>
      <span class="theme-toggle__icon theme-toggle__icon--moon">â˜½</span>
    </label>
  </main>
  <aside>
    <canvas width="1024" height="512"></canvas>
  </aside>
  <footer></footer>

  <script src="bg.js"></script>
  <script>
    const COPY = {
      title: "Hi there ðŸ‘‹",
      description: "This is a demo of a canvas-based background with smooth theme transitions. Click the button below to say hi!",
      links: [
        { name: "LinkedIn", url: "https://www.linkedin.com/in/gunkin" },
        { name: "Resume", url: "https://github.com/antongunkin/resume" },
      ],
    };

    /**
     * Theme detection & toggle.
     * Runs after bg.js so the MutationObserver is already watching <html>.
     * Changing the class triggers a smooth 5-second colour transition in the
     * canvas renderer.
     */
    (function () {
      var loaded = false;
      let activated = false;
      var toggle = document.getElementById("theme-switch");
      var html = document.documentElement;
      var main = document.querySelector("main");
      var footer = document.querySelector("footer");
      var btn = document.createElement("button");
      var title = document.createElement("h1");
      var desc = document.createElement("p");
      var links = document.createElement("div");

      function activate() {
        if (!activated) {
          activated = true;
          toggle.checked = mq.matches;
          toggle.disabled = false;
          applyTheme(mq.matches);
          btn.removeEventListener('click', activate);
          btn.addEventListener("click", deactivate);
          btn.textContent = "Close";

          setTimeout(function () {
            html.classList.add("activated");
          }, 400);
        }
      }

      function deactivate() {
        if (activated) {
          activated = false;
          html.classList.remove("theme-dark", "theme-light", "activated");
          btn.removeEventListener("click", deactivate);
          btn.addEventListener("click", activate);
          btn.textContent = "Say hi!";
        }
      }

      function applyTheme(dark) {
        html.classList.remove("theme-dark", "theme-light");
        html.classList.add(dark ? "theme-dark" : "theme-light");
      }

      function load() {
        if (!loaded) {
          loaded = true;
          btn.textContent = "Say hi!";
          btn.classList.add("btn");
          btn.addEventListener("click", activate);
          footer.appendChild(btn);
          title.textContent = COPY.title;
          desc.textContent = COPY.description;
          main.appendChild(title);
          main.appendChild(desc);
          COPY.links.forEach(function (link) {
            var a = document.createElement("a");
            a.textContent = link.name;
            a.href = link.url;
            a.target = "_blank";
            links.appendChild(a);
          });
          main.appendChild(links);

          setTimeout(function () {
            html.classList.add("loaded");
          }, 400);
        }
      }

      /* OS preference */
      var mq = window.matchMedia("(prefers-color-scheme: dark)");

      /* Manual toggle */
      toggle.addEventListener("change", function () {
        applyTheme(toggle.checked);
      });

      /* React to OS preference changes in real time */
      mq.addEventListener("change", function (e) {
        toggle.checked = e.matches;
        applyTheme(e.matches);
      });

      load();
    })();
  </script>
</body>

</html>